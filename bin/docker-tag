#!/usr/bin/env bash
set -Eeu -o pipefail

# """
# Add Docker tag.
# Updated 2020-02-16.
# """

image="${1:?}"
source_tag="${2:-bioc-release}"
dest_tag="${3:-latest}"
server="docker.io"

if [[ "$source_tag" == "$dest_tag" ]]
then
    echo "Source tag '${source_tag}' identical to dest tag '${dest_tag}'."
    exit 0
fi

docker login "$server"
docker pull "${server}/${image}:${source_tag}"
docker tag "${server}:${source_tag}" "${image}:${dest_tag}"
docker push "${server}/${image}:${dest_tag}"
